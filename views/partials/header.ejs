<nav>
  <a href="/" class="logo"><img src="../images/mmhlogo.png" alt="MeetMyHomes Logo"></a>
  <ul class="nav-links">
    <li>
      <select id="language-select" class="language-select" onchange="changeLanguage(this.value)">
        <option value="en">ğŸ‡¬ğŸ‡§ English</option>
        <option value="pt-PT">ğŸ‡µğŸ‡¹ Portuguese (Portugal)</option>
        <option value="pt">ğŸ‡§ğŸ‡· Portuguese (Brazil)</option>
        <option value="es">ğŸ‡ªğŸ‡¸ Spanish</option>
        <option value="fr">ğŸ‡«ğŸ‡· French</option>
        <option value="de">ğŸ‡©ğŸ‡ª German</option>
        <option value="it">ğŸ‡®ğŸ‡¹ Italian</option>
        <option value="nl">ğŸ‡³ğŸ‡± Dutch</option>
        <option value="sv">ğŸ‡¸ğŸ‡ª Swedish</option>
        <option value="da">ğŸ‡©ğŸ‡° Danish</option>
        <option value="no">ğŸ‡³ğŸ‡´ Norwegian</option>
        <option value="fi">ğŸ‡«ğŸ‡® Finnish</option>
        <option value="pl">ğŸ‡µğŸ‡± Polish</option>
        <option value="ru">ğŸ‡·ğŸ‡º Russian</option>
        <option value="zh-CN">ğŸ‡¨ğŸ‡³ Chinese (Simplified)</option>
        <option value="ja">ğŸ‡¯ğŸ‡µ Japanese</option>
        <option value="ko">ğŸ‡°ğŸ‡· Korean</option>
        <option value="ar">ğŸ‡¸ğŸ‡¦ Arabic</option>
        <option value="hi">ğŸ‡®ğŸ‡³ Hindi</option>
        <option value="tr">ğŸ‡¹ğŸ‡· Turkish</option>
        <option value="el">ğŸ‡¬ğŸ‡· Greek</option>
      </select>
    </li>
    <li><a href="/?hl=<%= getCurrentLanguage() %>" class="nav-link">Home</a></li>
    <li><a href="/properties?hl=<%= getCurrentLanguage() %>" class="nav-link">For Sale</a></li>

    <li><a href="/about?hl=<%= getCurrentLanguage() %>" class="nav-link">About</a></li>
    <li><a href="/contact?hl=<%= getCurrentLanguage() %>" class="nav-link">Contact</a></li>
  </ul>
</nav>

<!-- Google Translate element div in HTML -->
<div id="google_translate_element" style="display: none;"></div>

<script type="text/javascript">
  let translateInitialized = false;
  let comboBoxReady = false;
  let retryCount = 0;
  const maxRetries = 30; // ~15 seconds

  // Initialize Google Translate
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'en,pt-PT,pt,es,fr,de,it,nl,sv,da,no,fi,pl,ru,zh-CN,ja,ko,ar,hi,tr,el',
      layout: google.translate.TranslateElement.InlineLayout.DEFAULT,
      autoDisplay: false
    }, 'google_translate_element');
    translateInitialized = true;

    // Check for combo box with a maximum retry limit
    const checkComboBox = setInterval(() => {
      const googleCombo = document.querySelector('.goog-te-combo');
      if (googleCombo) {
        clearInterval(checkComboBox);
        comboBoxReady = true;
        // Set initial language from server or localStorage
        const lang = '<%= getCurrentLanguage() %>'; // From server
        const storedLang = localStorage.getItem('selectedLanguage') || lang;
        document.getElementById('language-select').value = storedLang;
        changeLanguage(storedLang);
      } else if (retryCount >= maxRetries) {
        clearInterval(checkComboBox);
      } else {
        retryCount++;
      }
    }, 500); // Check every 500ms
  }

  // Function to change language
  function changeLanguage(lang) {
    if (!comboBoxReady || !translateInitialized || !window.google || !window.google.translate) {
      setTimeout(() => changeLanguage(lang), 500); // Retry after 500ms
      return;
    }

    // Find the Google Translate combo box
    const googleCombo = document.querySelector('.goog-te-combo');
    if (googleCombo) {
      googleCombo.value = lang;
      googleCombo.dispatchEvent(new Event('change'));
    }

    // Update URL and localStorage
    window.history.replaceState({}, document.title, window.location.pathname + '?hl=' + lang);
    localStorage.setItem('selectedLanguage', lang);

    // Hide default Google Translate UI
    var frames = document.getElementsByClassName('goog-te-banner-frame');
    for (var i = 0; i < frames.length; i++) {
      frames[i].style.display = 'none';
    }
  }

  // Set initial language on page load
  document.addEventListener('DOMContentLoaded', () => {
    const lang = '<%= getCurrentLanguage() %>'; // From server
    const storedLang = localStorage.getItem('selectedLanguage') || lang;
    document.getElementById('language-select').value = storedLang;
    if (comboBoxReady && translateInitialized) {
      changeLanguage(storedLang);
    }
  });

  // Load Google Translate API
  var googleTranslateScript = document.createElement('script');
  googleTranslateScript.src = 'https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit';
  document.body.appendChild(googleTranslateScript);
</script>